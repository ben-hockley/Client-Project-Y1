{% extends 'mainTemplate.html'%}
{% block mainBlock%}
<h1>Account details</h1>
{% endblock%}

{% block mainBody%}
<section title="details">
    <p>First name:</p>
    <section id="firstNameData" label="first name">
    <p id="firstName">Undefined</p>
    </section>
    <p>Last name:</p>
    <section id="lastNameData" label="last name">
    <p id="lastName">Undefined</p>
    </section>
    <p>Username:</p>
    <section id="usernameData" label="username">
    <p id="username">Undefined</p>
    </section>
</section>

<script>
    document.addEventListener("DOMContentLoaded", getDetails())
    document.getElementById("firstNameData").addEventListener("click", editFirstName);
    document.getElementById("lastNameData").addEventListener("click", editLastName);
    document.getElementById("usernameData").addEventListener("click", editUsername);

    function editFirstName() {
        if(document.getElementById("firstForm")) {
            console.log("Form already open")
        }
        else {
        document.getElementById("firstName").innerHTML = "Enter new first name:"
        const firstForm = document.createElement("form");
        const newFirst = document.createElement("input");
        const button = document.createElement("button");
        firstForm.id = "firstForm";
        newFirst.setAttribute("type","text");
        button.innerHTML = "Change first name";
        button.id = "firstButton";
        firstForm.appendChild(newFirst);
        firstForm.appendChild(button);
        document.getElementById("firstNameData").appendChild(firstForm);
        document.getElementById("firstForm").setAttribute("action","/updateFirstname")
        document.getElementById("firstForm").setAttribute("method","post")
        }
    }

    function editFirstName() {
        if(document.getElementById("firstForm")) {
            console.log("Form already open")
        }
        else {
        const labelForm = document.createElement("label")
        labelForm.innerHTML = "Enter new first name:";
        labelForm.setAttribute("for","newFirstname");
        const firstForm = document.createElement("form");
        const newFirst = document.createElement("input");
        const button = document.createElement("button");
        firstForm.id = "firstForm";
        newFirst.setAttribute("type","text");
        newFirst.id = "newFirstname";
        newFirst.setAttribute("name","newFirstname")
        button.setAttribute("type","submit");
        button.innerHTML = "Change first name";
        firstForm.appendChild(labelForm);
        firstForm.appendChild(document.createElement("br"))
        firstForm.appendChild(newFirst);
        firstForm.appendChild(button);
        document.getElementById("firstNameData").appendChild(firstForm);
        document.getElementById("firstForm").setAttribute("action","/updateFirstname")
        document.getElementById("firstForm").setAttribute("method","post")
        }
    }

    function editUsername() {
        if(document.getElementById("userForm")) {
            console.log("Form already open")
        }
        else {
        const labelForm = document.createElement("label")
        labelForm.innerHTML = "Enter new username:";
        labelForm.setAttribute("for","newUsername");
        const firstForm = document.createElement("form");
        const newFirst = document.createElement("input");
        const button = document.createElement("button");
        firstForm.id = "userForm";
        newFirst.setAttribute("type","text");
        newFirst.id = "newUsername";
        newFirst.setAttribute("name","newUsername")
        button.setAttribute("type","submit");
        button.innerHTML = "Change username";
        firstForm.appendChild(labelForm);
        firstForm.appendChild(document.createElement("br"))
        firstForm.appendChild(newFirst);
        firstForm.appendChild(button);
        document.getElementById("usernameData").appendChild(firstForm);
        document.getElementById("userForm").setAttribute("action","/updateUsername")
        document.getElementById("userForm").setAttribute("method","post")
        }
    }

    function editLastName() {
        if(document.getElementById("lastForm")) {
            console.log("Form already open")
        }
        else {
        const labelForm = document.createElement("label")
        labelForm.innerHTML = "Enter new last name:";
        labelForm.setAttribute("for","newLastname");
        const firstForm = document.createElement("form");
        const newFirst = document.createElement("input");
        const button = document.createElement("button");
        firstForm.id = "lastForm";
        newFirst.setAttribute("type","text");
        newFirst.id = "newLastname";
        newFirst.setAttribute("name","newLastname")
        button.setAttribute("type","submit");
        button.innerHTML = "Change last name";
        firstForm.appendChild(labelForm);
        firstForm.appendChild(document.createElement("br"))
        firstForm.appendChild(newFirst);
        firstForm.appendChild(button);
        document.getElementById("lastNameData").appendChild(firstForm);
        document.getElementById("lastForm").setAttribute("action","/updateLastname")
        document.getElementById("lastForm").setAttribute("method","post")
        }
    }

    function getDetails() {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET",'/updateInfo',true);
        xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState === 4) {
                if (xhttp.status === 200) {
                    var text = xhttp.responseText;
                    if (text === "None") {
                        document.getElementById("firstName").innerHTML = "Please sign in";
                    } else {
                        jsonTuple = JSON.parse(text)
                        let firstname = jsonTuple[0]
                        let lastname = jsonTuple[1]
                        let username = jsonTuple[2]
                    document.getElementById("firstName").innerHTML = firstname;
                    document.getElementById("lastName").innerHTML = lastname;
                    document.getElementById("username").innerHTML = username;
                }
                } else {
                    console.error(xhttp.statusText);
                }
            }
        };
        xhttp.send();
    }
</script>
{% endblock%}